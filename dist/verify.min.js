/** Verify.js - v0.0.1 - 2013/06/18
 * https://github.com/jpillora/verify
 * Copyright (c) 2013 Jaime Pillora - MIT
 */
(function(t,e,i,n){function s(t,e){function s(){p("ajax error"),e.callback("There has been an error")}function r(){d.prompt(h,!1);for(var t=o.loading[m];t.length;)t.pop().success.apply(e,arguments);o.loaded[m]=arguments}var a={method:"GET",timeout:15e3},l=e._exec,h="GroupRuleExecution"===l.type?l.element.domElem:e.field,c=t.success,f=t.error,d=l.element.options,m=JSON?JSON.stringify(t):u(),g={success:c,error:f||s};if(o.loaded[m]){var v=o.loaded[m],y=g.success;return y.apply(e,v),n}if(o.loading[m]||(o.loading[m]=[]),o.loading[m].push(g),1===o.loading[m].length){d.prompt(h,"Checking...","load");var x={success:r,error:r};l.ajax=i.ajax(i.extend(a,t,x))}}function r(t){i.extend(!0,this,t)}(function(e){function i(){this.suppressLog||o("log",this,arguments)}function s(){o("warn",this,arguments)}function r(){o("info",this,arguments)}function o(i,s,r){if(t.console!==n&&t.console.isFake!==!0){var o=e.map(r,h);o[0]=[s.prefix,o[0],s.postfix].join("");var u="boolean"===e.type(o[o.length-1])?o.pop():null;u===!0&&t.console.group(o[0]),o[0]&&null===u&&(t.navigator.userAgent.indexOf("MSIE")>=0?t.console.log(o.join(",")):t.console[i].apply(t.console,o)),u===!1&&t.console.groupEnd()}}function u(t){return{log:function(){i.apply(t,arguments)},warn:function(){s.apply(t,arguments)},info:function(){r.apply(t,arguments)}}}t.console===n&&(t.console={isFake:!0});for(var a=["log","warn","info","group","groupCollapsed","groupEnd"],l=a.length-1;l>=0;l--)t.console[a[l]]===n&&(t.console[a[l]]=e.noop);if(e){var h=function(t){return t},c=function(t){return t=e.extend({},c.defaults,t),u(t)};c.defaults={suppressLog:!1,prefix:"",postfix:""},e.extend(c,u(c.defaults)),e.console===n&&(e.console=c),e.consoleNoConflict=c}})(jQuery);var o={loading:{},loaded:{}},u=function(){return u.curr++};u.curr=1,i.fn.verifyScrollView=function(t){var e=i(this).first();return 1!==e.length?i(this):i(this).verifyScrollTo(e,t)},i.fn.verifyScrollTo=function(t,e,n){"function"==typeof e&&2==arguments.length&&(n=e,e=t);var s=i.extend({scrollTarget:t,offsetTop:50,duration:500,easing:"swing"},e);return this.each(function(){var t=i(this),e="number"==typeof s.scrollTarget?s.scrollTarget:i(s.scrollTarget),r="number"==typeof e?e:e.offset().top+t.scrollTop()-parseInt(s.offsetTop,10);t.animate({scrollTop:r},parseInt(s.duration,10),s.easing,function(){"function"==typeof n&&n.call(this)})})},i.fn.verifyEquals=function(t){if(i(this).length!==t.length)return!1;for(var e=0,n=i(this).length;n>e;++e)if(i(this)[e]!==t[e])return!1;return!0};var a=null;(function(){var t=!1,e=/xyz/.test(function(){})?/\b_super\b/:/.*/;a=function(){},a.extend=function(i){function n(){!t&&this.init&&this.init.apply(this,arguments)}var s=this.prototype;t=!0;var r=new this;t=!1;for(var o in i)r[o]="function"==typeof i[o]&&"function"==typeof s[o]&&e.test(i[o])?function(t,e){return function(){var i=this._super;this._super=s[t];var n=e.apply(this,arguments);return this._super=i,n}}(o,i[o]):i[o];return n.prototype=r,n.prototype.constructor=n,n.extend=arguments.callee,n}})();var l=a.extend({init:function(t,e){this.name=e?e:"Set_"+u(),this.array=[],this.addAll(t)},indexOf:function(t){for(var e=0,n=this.array.length;n>e;++e)if(i.isFunction(t)?t(this.get(e)):this.equals(this.get(e),t))return e;return-1},find:function(t){return this.get(this.indexOf(t))||null},get:function(t){return this.array[t]},has:function(t){return!!this.find(t)},add:function(t){return this.has(t)?!1:(this.array.push(t),!0)},addAll:function(t){if(!t)return 0;i.isArray(t)||(t=[t]);for(var e=0,n=0,s=t.length;s>n;++n)this.add(t[n])&&e++;return e},remove:function(t){for(var e=[],i=0,n=this.array.length;n>i;++i)this.verifyEquals(this.get(i),t)||e.push(this.get(i));return this.array=e,t},removeAll:function(){this.array=[]},equals:function(t,e){return t&&e&&t.verifyEquals!==n&&e.verifyEquals!==n?t.verifyEquals(e):t===e},each:function(t){for(var e=0,i=this.array.length;i>e;++e)if(t(this.get(e))===!1)return},map:function(t){return i.map(this.array,t)},filter:function(t){return i.grep(this.array,t)},size:function(){return this.array.length},getArray:function(){return this.array}}),h=l.extend({init:function(t,e,i){this.type=t,this._super(e,i)},add:function(t){t instanceof this.type?this._super(t):this.log("add failed - invalid type")}}),c={create:function(t){function e(){}return e.prototype=t,new e},bind:i.proxy,checkOptions:function(t){if(t)for(var e in t)v[e]===n&&m("Invalid option: '"+e+"'")},appendArg:function(t,e,i){i||(i=0);var n=[].slice.call(t,i);return n[i]=e+n[i],n},memoize:function(t){return function(){for(var e=Array.prototype.slice.call(arguments),i="",n=e.length,s=null;n--;)s=e[n],i+=s===Object(s)?JSON.stringify(s):s,t.memoize||(t.memoize={});return i in t.memoize?t.memoize[i]:t.memoize[i]=t.apply(this,e)}},isRTL:function(t){var n=i(e),s=i("body"),r=t&&t.hasClass("rtl")||t&&"rtl"===(t.attr("dir")||"").toLowerCase()||n.hasClass("rtl")||"rtl"===(n.attr("dir")||"").toLowerCase()||s.hasClass("rtl")||"rtl"===(s.attr("dir")||"").toLowerCase();return Boolean(r)}},f="0.0.1",d=i.consoleNoConflict({prefix:"verify.js: "}),p=d.log,m=d.warn,g=d.info,v={debug:!1,autoInit:!0,validateAttribute:"data-validate",validationEventTrigger:"blur",scroll:!0,focusFirstField:!0,hideErrorOnChange:!1,skipHiddenFields:!0,skipDisabledFields:!0,errorClass:"error",errorContainer:function(t){return t},reskinContainer:function(t){return t},beforeSubmit:function(t,e){return e},track:i.noop,showPrompt:!0,prompt:function(t,e,n){"function"===i.type(i.notify)&&(n||(n={color:"red"}),i.notify(t,e,n))}};r.prototype=v;var y=a.extend({name:"Class",toString:function(){return(this.type?this.type+": ":"")+(this.name?this.name+": ":"")},log:function(){v.debug&&p.apply(this,c.appendArg(arguments,""+this))},warn:function(){m.apply(this,c.appendArg(arguments,""+this))},info:function(){g.apply(this,c.appendArg(arguments,""+this))},bind:function(t){var e=this[t];e&&i.isFunction(e)&&(this[t]=c.bind(e,this))},bindAll:function(){for(var t in this)this.bind(t)},nextTick:function(e,i,n){var s=this;return t.setTimeout(function(){e.apply(s,i)},n||0)}}),x=y.extend({init:function(t,e){return this.name=t,i.isPlainObject(e)?(this.type=e.__ruleType,this.extendInterface(e.extend),this.userObj||(this.userObj={}),i.extend(!0,this.userObj,e),this.buildFn(),this.ready="function"==typeof this.fn,n):this.warn("rule definition must be a function or an object")},extendInterface:function(t){if(t&&"string"==typeof t){for(var e,i=t;i;){if(i===this.name)return this.error("Rule already extends '%s'",t);e=b.getRawRule(i),i=e?e.extend:null}var n=b.getRule(t);if(!n)return this.warn("Rule missing '%s'",i);if(this.parent=n,!(n instanceof x))return this.error("Cannot extend: '"+otherName+"' invalid type");this.userObj=c.create(n.userObj),this.userObj.parent=n.userObj}},buildFn:function(){if(i.isFunction(this.userObj.fn))this.fn=this.userObj.fn;else{if("regexp"!==i.type(this.userObj.regex))return this.error("Rule has no function");this.fn=function(t){return function(e){return t.test(e.val())?!0:e.message||"Invalid Format"}}(this.userObj.regex)}},defaultInterface:{log:p,warn:m,ajax:function(t){s(t,this)}},defaultFieldInterface:{val:function(){return this.field.val.apply(this.field,arguments)}},defaultGroupInterface:{val:function(t,e){var i=this.field(t);return i?e===n?i.val():i.val(e):n},field:function(t){var e=i.grep(this._exec.members,function(e){return e.id===t}),n=e.length?e[0].element.domElem:null;return n||this.warn("Cannot find group element with id: '"+t+"'"),n},fields:function(){return i().add(i.map(this._exec.members,function(t){return t.element.domElem}))}},buildInterface:function(t){var e=[];return e.push({}),e.push(this.userObj),e.push(this.defaultInterface),"field"===this.type?(e.push(this.defaultFieldInterface),e.push({field:t.element.domElem})):"group"===this.type&&e.push(this.defaultGroupInterface),e.push({prompt:t.element.options.prompt,form:t.element.form.domElem,callback:t.callback,args:t.args,_exec:t}),i.extend.apply(this,e)}}),b=null;(function(){var t=function(t){for(var e,s,r=t.split(""),o=[],u=0,a=0,l=r.length;l>a;++a){if(e=r[a],"("===e&&u++,")"===e&&u--,u>1)return null;","===e&&1===u&&(r[a]=";")}return 0!==u?null:(i.each(r.join("").split(","),function(e,i){return(s=i.match(/^(\w+)(\.(\w+))?(\#(\w+))?(\(([^;\)]+(\;[^;\)]+)*)\))?$/))?(i={},i.name=s[1],s[3]&&(i.scope=s[3]),s[5]&&(i.id=s[5]),i.args=s[7]?s[7].split(";"):[],o.push(i),n):m("Invalid validate attribute: "+t)}),o)},e=c.memoize(t),s={},r={},o=function(t,e){for(var n in e)s[n]&&m("validator '%s' already exists",n),i.isFunction(e[n])&&(e[n]={fn:e[n]}),e[n].__ruleType=t;i.extend(!0,s,e)},u=function(t){o("field",t)},a=function(t){o("group",t)},l=function(t){return s[t]},h=function(t){var e=r[t],i=s[t];return i?e||(e=r[t]=new x(t,i)):m("Missing rule: "+t),e},f=function(t){var i=t.form.options.validateAttribute,n=t.domElem.attr(i);return n?e(n):null},d=function(t){var e=!1,n=null,s=[];return"ValidationField"!==t.type?m("Cannot get rules from invalid type"):t.domElem?(n=this.parseAttribute(t),n&&n.length?(i.each(n,function(t,i){/required/.test(i.name)&&(e=!0),i.rule=h(i.name),i.rule&&s.push(i)}),s.required=e,s):s):s};b={addFieldRules:u,addGroupRules:a,getRule:h,getRawRule:l,parseString:t,parseAttribute:f,parseElement:d}})();var E=null;(function(){var t=y.extend({type:"ValidationElement",init:function(t){if(!t||!t.length)throw"Missing Element";return this.domElem=t,this.bindAll(),this.name=this.domElem.attr("name")||this.domElem.attr("id")||u(),this.execution=null,t.data("verify")?!1:(t.data("verify",this),!0)},equals:function(e){var i,n;return this.domElem?(i=this.domElem,e.jquery?n=e:e instanceof t&&e.domElem&&(n=e.domElem),i.verifyEquals&&n.verifyEquals?i.verifyEquals(n):!1):!1}}),s=t.extend({type:"ValidationField",init:function(t,e){this._super(t),this.form=e,this.options=e.options,this.groups=e.groups,this.ruleNames=null,this.touched=!1},validate:function(t){t||(t=i.noop);var e=new j(this);e.execute().done(function(){t(!0)}).fail(function(){t(!1)})},update:function(){this.rules=b.parseElement(this);for(var t=0;this.rules.length>t;++t){var e=this.rules[t];if(e.rule&&"group"===e.rule.type){this.groups[e.name]||(this.groups[e.name]={});var i=e.scope||"default";this.groups[e.name][i]||(this.groups[e.name][i]=new h(s)),this.groups[e.name][i].add(this)}}},handleResult:function(t){var e=this.options,i=e.reskinContainer(this.domElem);if(!i||!i.length)return this.warn("No reskin element found. Check 'reskinContainer' option.");e.showPrompt&&e.prompt(i,t.response);var n=e.errorContainer(i);n&&n.length&&n.toggleClass(e.errorClass,!t.success),this.options.track("Validate",[this.form.name,this.name].join(" "),t.success?"Valid":t.response?'"'+t.response+'"':"Silent Fail")},scrollFocus:function(t){var e=i.noop;this.options.focusFirstField&&(e=function(){t.focus()}),this.options.scroll?t.verifyScrollView(e):this.options.focusFirstField&&field.focus()}});E=t.extend({type:"ValidationForm",init:function(t,o){if(this._super(t),!t.is("form"))throw"Must be a form";this.options=new r(o),this.fields=new h(s),this.groups={},this.fieldByName={},this.invalidFields={},this.fieldHistory={},this.submitResult=n,this.submitPending=!1,this.cache={ruleNames:{},ajax:{loading:{},loaded:{}}},i(e).ready(this.domReady)},extendOptions:function(t){i.extend(!0,this.options,t)},domReady:function(){this.bindEvents(),this.updateFields(),this.log("bound to "+this.fields.size()+" elems")},bindEvents:function(){this.domElem.on("keyup.jqv","input",this.onKeyup).on("blur.jqv","input[type=text]:not(.hasDatepicker),input:not([type].hasDatepicker)",this.onValidate).on("change.jqv","input[type=text].hasDatepicker,select,[type=checkbox],[type=radio]",this.onValidate).on("submit.jqv",this.onSubmit).trigger("initialised.jqv")},unbindEvents:function(){this.domElem.off(".jqv")},updateFields:function(){var t="["+this.options.validateAttribute+"]";this.domElem.find(t).each(this.updateField)},updateField:function(t,e){t.jquery!==n&&(e=t),e.jquery===n&&(e=i(e));var r,o,u="input:not([type=hidden]),select,textarea";return e.is(u)?(o=e,r=this.fields.find(o),r||(r=new s(o,this),this.fields.add(r)),r.update(),r):this.warn("Validators will not work on container elements ("+e.prop("tagName")+"). Please use INPUT, SELECT or TEXTAREA.")},onSubmit:function(t){var e=!1;return this.submitPending&&this.warn("pending..."),this.submitPending||this.submitResult!==n?this.submitResult!==n&&(e=this.options.beforeSubmit.call(this.domElem,t,this.submitResult)):(this.submitPending=!0,this.validate(this.doSubmit)),e||t.preventDefault(),e},doSubmit:function(t){this.log("doSubmit",t),this.submitPending=!1,this.submitResult=t,this.domElem.submit(),this.submitResult=n},onKeyup:function(t){this.options.hideErrorOnChange&&this.options.prompt(i(t.currentTarget),null)},onValidate:function(t){var e=i(t.currentTarget),n=e.data("verify")||this.updateField(e);n.log("validate"),n.validate(i.noop)},validate:function(t){t||(t=i.noop),this.updateFields();var e=new w(this);e.execute().done(function(){t(!0)}).fail(function(){t(!1)})}})})();var w=null,j=null;(function(){var t={NOT_STARTED:0,RUNNING:1,COMPLETE:2},e=y.extend({type:"Execution",init:function(e,i){this.element=e,e&&(this.prevExec=e.execution,e.execution=this,this.options=this.element.options,this.domElem=e.domElem),this.parent=i,this.name="#"+u(),this.status=t.NOT_STARTED,this.bindAll(),this.d=this.restrictDeferred(),this.d.done(this.executePassed),this.d.fail(this.executeFailed)},isPending:function(){return this.prevExec&&this.prevExec.status!==t.COMPLETE},toString:function(){return this._super()+"["+this.element.name+(this.rule?":"+this.rule.name:"")+"] "},serialize:function(t){var e=this.mapExecutables(t);if(!i.isArray(e)||0===e.length)return this.resolve();var n=e[0](),s=1,r=e.length;if(this.log("SERIALIZE",r),!n||!n.pipe)throw"Invalid Deferred Object";for(;r>s;s++)n=n.pipe(e[s]);return n.done(this.resolve).fail(this.reject),this.d.promise()},parallelize:function(t){function e(t){o++,o===a&&r.resolve(t)}function n(t){l||(l=!0,r.reject(t))}var s=this.mapExecutables(t),r=this,o=0,u=0,a=s.length,l=!1;if(this.log("PARALLELIZE",a),!i.isArray(s)||0===a)return this.resolve();for(;a>u;++u){var h=s[u]();if(!h||!h.done||!h.fail)throw"Invalid Deferred Object";h.done(e).fail(n)}return this.d.promise()},mapExecutables:function(t){return i.map(t,function(t){if(i.isFunction(t))return t;if(i.isFunction(t.execute))return t.execute;throw"Invalid executable"})},linkPass:function(t){t.d.done(this.resolve)},linkFail:function(t){t.d.fail(this.reject)},link:function(t){this.linkPass(t),this.linkFail(t)},execute:function(){for(var e=this.parent,i=[];e;)i.unshift(e.name),e=e.parent;var n="("+i.join(" < ")+")";return this.log(this.parent?n:"","executing..."),this.status=t.RUNNING,this.domElem&&this.domElem.triggerHandler("validating"),!0},executePassed:function(t){this.success=!0,this.response=this.filterResponse(t),this.executed()},executeFailed:function(t){this.success=!1,this.response=this.filterResponse(t),this.executed()},executed:function(){this.status=t.COMPLETE,this.log((this.success?"Passed":"Failed")+": "+this.response),this.domElem&&this.domElem.triggerHandler("validated",this.success)},resolve:function(t){return this.resolveOrReject(!0,t)},reject:function(t){return this.resolveOrReject(!1,t)},resolveOrReject:function(t,e){var i=t?"__resolve":"__reject";if(!this.d||!this.d[i])throw"Invalid Deferred Object";return this.nextTick(this.d[i],[e],0),this.d.promise()},restrictDeferred:function(t){return t||(t=i.Deferred()),t.__reject=t.reject,t.__resolve=t.resolve,t.reject=t.resolve=function(){console.error("Use execution.resolve|reject()")},t},filterResponse:function(t){return"string"==typeof t?t:null}});w=e.extend({type:"FormExecution",init:function(t){this._super(t),this.ajaxs=[],this.children=this.element.fields.map(i.proxy(function(t){return new j(t,this)},this))},execute:function(){return this._super(),this.isPending()?(this.warn("pending... (waiting for %s)",this.prevExec.name),this.reject()):(this.log("exec fields #"+this.children.length),this.parallelize(this.children))}}),j=e.extend({type:"FieldExecution",init:function(t,e){this._super(t,e),e instanceof w&&(this.formExecution=e),t.touched=!0,this.children=[]},execute:function(){if(this._super(),this.isPending())return this.warn("pending... (waiting for %s)",this.prevExec.name),this.reject();var t=b.parseElement(this.element);return this.skip=this.skipValidations(t),this.skip?this.resolve():(this.children=i.map(t,i.proxy(function(t){return"group"===t.rule.type?new r(t,this):new s(t,this)},this)),this.serialize(this.children))},skipValidations:function(t){return 0===t.length?(this.log("skip (no validators)"),!0):t.required||i.trim(this.domElem.val())?this.options.skipHiddenFields&&this.options.reskinContainer(this.domElem).is(":hidden")?(this.log("skip (hidden)"),!0):this.options.skipDisabledFields&&this.domElem.is("[disabled]")?(this.log("skip (disabled)"),!0):!1:(this.warn("skip (not required)"),!0)},executed:function(){this._super();var t,e=this,i=this.children;for(t=0;i.length>t;++t)if(i[t].success===!1){e=i[t];break}this.element.handleResult(e)}});var s=e.extend({type:"RuleExecution",init:function(t,e){this._super(null,e),this.rule=t.rule,this.args=t.args,this.element=this.parent.element,this.options=this.element.options,this.rObj={}},callback:function(t){clearTimeout(this.t),this.callbackCount++,this.log(this.rule.name+" (cb:"+this.callbackCount+"): "+t),this.callbackCount>1||(t===n&&this.warn("Undefined result"),t===!0?this.resolve(t):this.reject(t))},timeout:function(){this.warn("timeout!"),this.callback("Timeout")},execute:function(){if(this._super(),this.callbackCount=0,!this.element||!this.rule.ready)return this.warn(this.element?"not  ready.":"invalid parent."),this.resolve();this.t=setTimeout(this.timeout,1e4),this.r=this.rule.buildInterface(this);var t;try{t=this.rule.fn(this.r)}catch(e){t=!0,console.error("Error caught in validation rule: '"+this.rule.name+"', skipping.\nERROR: "+(""+e)+"\nSTACK:"+e.stack)}return t!==n&&this.nextTick(this.callback,[t]),this.d.promise()},templateResponse:function(t,e){var i=this.r[e];return i!==n?i:(this.warn("Could not find r."+e),e)},filterResponse:function(t){return"string"==typeof t?t.replace(/\{\{\s*(\w+)\s*\}\}/g,this.templateResponse):null}}),r=s.extend({type:"GroupRuleExecution",init:function(t,e){if(this._super(t,e),this.groupName=t.name,this.id=t.id,this.scope=t.scope||"default",this.group=this.element.groups[this.groupName][this.scope],!this.group)throw"Missing Group Set";1===this.group.size()&&this.warn("Group only has 1 field. Consider a field rule.")},execute:function(){var e,i,s,r=this.group.exec,o=this.parent,u=o&&o.parent,a=!u,l=u instanceof w,h=!1;if(r&&r.status!==t.COMPLETE){for(this.members=r.members,e=0;this.members.length>e;++e)this.element===this.members[e].element&&(h=!0);if(h)return this.log("ALREADY A MEMBER OF %s",r.name),this.reject(),n;this.log("SLAVE TO %s",r.name),this.members.push(this),this.link(r),this.parent&&r.linkFail(this.parent)}else this.log("MASTER"),this.members=[this],this.executeGroup=this._super,r=this.group.exec=this,l&&r.linkFail(u);if(a)for(e=0;this.group.size()>e;++e)if(i=this.group.get(e),this.element!==i){if(this.log("CHECK:",i.name),!i.touched)return this.log("FIELD NOT READY: ",i.name),this.reject();s=i.execution,s&&s.status!==t.COMPLETE&&s.reject(),this.log("STARTING ",i.name),s=new j(i,this),s.execute()}var c=this.group.size(),f=r.members.length;return c===f&&r.status===t.NOT_STARTED?(r.log("RUN"),r.executeGroup()):this.log("WAIT ("+f+"/"+c+")"),this.d.promise()},filterResponse:function(t){var e=null;if(t&&this.members.length){var n=i.isPlainObject(t),s="string"==typeof t;s&&this===this.group.exec?e=t:n&&t[this.id]&&(e=t[this.id])}return this._super(e)}})})(),i.fn.validate=function(t){var e=i(this).data("verify");e?e.validate(t):m("element does not have verifyjs attached")},i.fn.validate.version=f,i.fn.verify=function(t){return this.each(function(){var e=i.verify.forms.find(i(this));return t===!1||"destroy"===t?(e&&(e.unbindEvents(),i.verify.forms.remove(e)),n):(c.checkOptions(t),e?(e.extendOptions(t),e.updateFields()):(e=new E(i(this),t),i.verify.forms.add(e)),n)})},i.verify=function(t){c.checkOptions(t),i.extend(v,t)},i.extend(i.verify,{version:f,updateRules:b.updateRules,addRules:b.addFieldRules,addFieldRules:b.addFieldRules,addGroupRules:b.addGroupRules,log:g,warn:m,defaults:v,globals:v,utils:c,forms:new h(E,[],"FormSet"),_hidden:{ruleManager:b}}),i(function(){v.autoInit&&i("form").filter(function(){return i(this).find("["+v.validateAttribute+"]").length>0}).verify()}),p("plugin added.")})(window,document,jQuery);